function a35_0x285d(_0xa1ef46,_0x301913){const _0x2fe8b0=a35_0x2fe8();return a35_0x285d=function(_0x285df6,_0x5f5c18){_0x285df6=_0x285df6-0x8d;let _0x596e60=_0x2fe8b0[_0x285df6];return _0x596e60;},a35_0x285d(_0xa1ef46,_0x301913);}const a35_0x3e87ba=a35_0x285d;(function(_0x452752,_0x4e76ca){const _0x301693=a35_0x285d,_0x369a44=_0x452752();while(!![]){try{const _0x22a12a=parseInt(_0x301693(0xa5))/0x1*(-parseInt(_0x301693(0xae))/0x2)+parseInt(_0x301693(0xaa))/0x3+parseInt(_0x301693(0x93))/0x4+-parseInt(_0x301693(0xb3))/0x5*(-parseInt(_0x301693(0x9a))/0x6)+parseInt(_0x301693(0xb2))/0x7*(parseInt(_0x301693(0xb0))/0x8)+-parseInt(_0x301693(0x9e))/0x9*(parseInt(_0x301693(0xaf))/0xa)+-parseInt(_0x301693(0xa0))/0xb;if(_0x22a12a===_0x4e76ca)break;else _0x369a44['push'](_0x369a44['shift']());}catch(_0xd19b14){_0x369a44['push'](_0x369a44['shift']());}}}(a35_0x2fe8,0xab981));import{EJSON}from'bson';import{baseDb}from'./basedb';import{QueryType}from'./constant';function a35_0x2fe8(){const _0x4b3375=['config','formatResDocumentData','get','string','toString','send','1758924ZbUKiX','Object','_request','remove','length','map','slice','6237288KQvFhK','_coll','update','set','9158463rwAuEf','SET_PARAM_ERROR','18037679lrJXDT','database.updateDocument','updated','keys','doc','32ejQIeE','assign','INVALID_PARAM','request_id','encodeEJSON','2605689UbqENG','deleted','prototype','database.getDocument','15422SMuVUj','10DQQhhA','40lYSoYw','DOC','1762817buQxdw','5CiUycX','call','SET_PARAM_OBJECT_ERROR','UPDATE_PARAM_OBJECT_ERROR','reqClass','_db'];a35_0x2fe8=function(){return _0x4b3375;};return a35_0x2fe8();}import{DataBaseError,ErrorMsg,ERRORS}from'./Errors';import{serialize}from'./serializer/datatype';import{UpdateSerializer}from'./serializer/update';import{formatRequestServerDateParams,Util}from'./util';import{hasOwnProperty,stringifyByEJSON}from'./util';export class DocumentReference{constructor(_0x3cad92,_0x164185,_0x1947a7){const _0x374d5f=a35_0x285d;this[_0x374d5f(0xb8)]=_0x3cad92,this['_coll']=_0x164185,this['id']=_0x1947a7,this['_request']=new baseDb[(_0x374d5f(0xb7))](this['_db'][_0x374d5f(0x8d)]);}async[a35_0x3e87ba(0x8f)](){const _0x119edc=a35_0x3e87ba;var _0x3bec2a,_0x1ccf88;const _0x3795d9=stringifyByEJSON({'_id':this['id']}),_0x59db16={'collection_name':this['_coll'],'query':_0x3795d9,'query_type':QueryType[_0x119edc(0xb1)],'multi':![]},_0x31433e=await this[_0x119edc(0x95)][_0x119edc(0x92)](_0x119edc(0xad),_0x59db16),_0x1fa087=(_0x3bec2a=_0x31433e===null||_0x31433e===void 0x0?void 0x0:_0x31433e['list'])===null||_0x3bec2a===void 0x0?void 0x0:_0x3bec2a[_0x119edc(0x98)](_0x4ae20d=>EJSON['parse'](_0x4ae20d)),_0x14c45d=Util[_0x119edc(0x8e)](_0x1fa087!==null&&_0x1fa087!==void 0x0?_0x1fa087:[]);return{'data':_0x14c45d,'requestId':(_0x1ccf88=_0x31433e===null||_0x31433e===void 0x0?void 0x0:_0x31433e[_0x119edc(0xa8)])!==null&&_0x1ccf88!==void 0x0?_0x1ccf88:''};}async['set'](_0x2d239b){const _0x495827=a35_0x3e87ba;var _0x10b776,_0x5c2586;if(typeof this['id']!==_0x495827(0x90)||this['id']==='')throw new DataBaseError(Object['assign'](Object[_0x495827(0xa6)]({},ERRORS[_0x495827(0xa7)]),{'errMsg':ErrorMsg[_0x495827(0xa4)][_0x495827(0x9d)][_0x495827(0x9f)]}));if(!(_0x2d239b&&Object[_0x495827(0xac)][_0x495827(0x91)][_0x495827(0xb4)](_0x2d239b)[_0x495827(0x99)](0x8,-0x1)!==_0x495827(0x94)&&Object[_0x495827(0xa3)](_0x2d239b)[_0x495827(0x97)]>0x0))throw new DataBaseError(Object['assign'](Object[_0x495827(0xa6)]({},ERRORS[_0x495827(0xa7)]),{'errMsg':ErrorMsg['doc'][_0x495827(0x9d)][_0x495827(0xb5)]}));if(hasOwnProperty(_0x2d239b,'_id'))throw new DataBaseError(Object[_0x495827(0xa6)](Object[_0x495827(0xa6)]({},ERRORS[_0x495827(0xa7)]),{'errMsg':ErrorMsg[_0x495827(0xa4)]['set']['SET_PARAM_HAS_ID_ERROR']}));let _0x468ae2={'collection_name':this[_0x495827(0x9b)],'query_type':QueryType['DOC'],'update_data':stringifyByEJSON(serialize(_0x2d239b)),'multi':![],'merge':![],'upsert':!![]};this['id']&&(_0x468ae2=Object[_0x495827(0xa6)](_0x468ae2,{'query':stringifyByEJSON({'_id':this['id']})}));const _0x280428=await this['_request'][_0x495827(0x92)](_0x495827(0xa1),formatRequestServerDateParams(_0x468ae2));return{'updated':(_0x10b776=_0x280428===null||_0x280428===void 0x0?void 0x0:_0x280428[_0x495827(0xa2)])!==null&&_0x10b776!==void 0x0?_0x10b776:0x0,'requestId':(_0x5c2586=_0x280428===null||_0x280428===void 0x0?void 0x0:_0x280428['request_id'])!==null&&_0x5c2586!==void 0x0?_0x5c2586:''};}async['update'](_0x1147ae){const _0x44e195=a35_0x3e87ba;var _0x16782c,_0x18c442;if(typeof this['id']!=='string'||this['id']==='')throw new DataBaseError(Object[_0x44e195(0xa6)](Object[_0x44e195(0xa6)]({},ERRORS['INVALID_PARAM']),{'errMsg':ErrorMsg[_0x44e195(0xa4)][_0x44e195(0x9c)]['UPDATE_PARAM_ERROR']}));if(!(_0x1147ae&&Object[_0x44e195(0xac)][_0x44e195(0x91)][_0x44e195(0xb4)](_0x1147ae)[_0x44e195(0x99)](0x8,-0x1)!==_0x44e195(0x94)&&Object[_0x44e195(0xa3)](_0x1147ae)[_0x44e195(0x97)]>0x0))throw new DataBaseError(Object['assign'](Object[_0x44e195(0xa6)]({},ERRORS[_0x44e195(0xa7)]),{'errMsg':ErrorMsg['doc'][_0x44e195(0x9c)][_0x44e195(0xb6)]}));if(hasOwnProperty(_0x1147ae,'_id'))throw new DataBaseError(Object['assign'](Object['assign']({},ERRORS[_0x44e195(0xa7)]),{'errMsg':ErrorMsg['doc']['update']['UPDATE_PARAM_HAS_ID_ERROR']}));const _0xa173f7=stringifyByEJSON({'_id':this['id']}),_0x5190da={'collection_name':this[_0x44e195(0x9b)],'update_data':UpdateSerializer[_0x44e195(0xa9)](_0x1147ae),'query':_0xa173f7,'query_type':QueryType[_0x44e195(0xb1)],'multi':![],'merge':!![],'upsert':![]},_0xe1546e=await this[_0x44e195(0x95)][_0x44e195(0x92)](_0x44e195(0xa1),formatRequestServerDateParams(_0x5190da));return{'updated':(_0x16782c=_0xe1546e===null||_0xe1546e===void 0x0?void 0x0:_0xe1546e['updated'])!==null&&_0x16782c!==void 0x0?_0x16782c:0x0,'requestId':(_0x18c442=_0xe1546e===null||_0xe1546e===void 0x0?void 0x0:_0xe1546e[_0x44e195(0xa8)])!==null&&_0x18c442!==void 0x0?_0x18c442:''};}async[a35_0x3e87ba(0x96)](){const _0xf5fc81=a35_0x3e87ba;var _0x239852,_0xe6358e;const _0x50244b=stringifyByEJSON({'_id':this['id']}),_0x3dc1e9={'collection_name':this[_0xf5fc81(0x9b)],'query':_0x50244b,'query_type':QueryType[_0xf5fc81(0xb1)],'multi':![]},_0x205e7e=await this['_request'][_0xf5fc81(0x92)]('database.removeDocument',_0x3dc1e9);return{'deleted':(_0x239852=_0x205e7e[_0xf5fc81(0xab)])!==null&&_0x239852!==void 0x0?_0x239852:0x0,'requestId':(_0xe6358e=_0x205e7e['request_id'])!==null&&_0xe6358e!==void 0x0?_0xe6358e:''};}}