'use strict';function a15_0x4531(_0x41e519,_0x5ea5ea){const _0x2d13fe=a15_0x2d13();return a15_0x4531=function(_0x45316f,_0x57f551){_0x45316f=_0x45316f-0xa1;let _0x3f09bf=_0x2d13fe[_0x45316f];return _0x3f09bf;},a15_0x4531(_0x41e519,_0x5ea5ea);}const a15_0x384a08=a15_0x4531;(function(_0x499099,_0x1377cb){const _0x2b5772=a15_0x4531,_0x1b7df6=_0x499099();while(!![]){try{const _0x412697=-parseInt(_0x2b5772(0xf1))/0x1+-parseInt(_0x2b5772(0xd7))/0x2*(parseInt(_0x2b5772(0xb5))/0x3)+-parseInt(_0x2b5772(0xd0))/0x4+-parseInt(_0x2b5772(0xc7))/0x5*(parseInt(_0x2b5772(0xf2))/0x6)+parseInt(_0x2b5772(0xb6))/0x7*(parseInt(_0x2b5772(0xeb))/0x8)+parseInt(_0x2b5772(0xb7))/0x9+parseInt(_0x2b5772(0xa5))/0xa;if(_0x412697===_0x1377cb)break;else _0x1b7df6['push'](_0x1b7df6['shift']());}catch(_0x3e2fa9){_0x1b7df6['push'](_0x1b7df6['shift']());}}}(a15_0x2d13,0x3125e));Object[a15_0x384a08(0xac)](exports,a15_0x384a08(0xe4),{'value':!![]}),exports['Query']=void 0x0;const bson_1=require(a15_0x384a08(0xa7)),basedb_1=require('./basedb'),constant_1=require(a15_0x384a08(0xba)),Errors_1=require('./Errors'),query_1=require(a15_0x384a08(0xdc)),update_1=require('./serializer/update'),util_1=require(a15_0x384a08(0xd2)),util_2=require('./util');function a15_0x2d13(){const _0x5b1ad9=['_apiOptions','request_id','DataBaseError','588008OCvfvf','call','./util','hasOwnProperty','OrderDirectionList','_db','Util','783908MnVIWR','QueryType','number','SKIP_PARAM_ERROR','WHREE_PARAM_UNDEFINED_ERROR','./serializer/query','send','parse','keys','boolean','database.getDocument','get','updated','__esModule','list','UpdateSerializer','stringifyByEJSON','reqClass','limit','formatResDocumentData','32BBuhiz','database.removeDocument','ORDER_BY_DIRECTION_ERROR','where','_coll','slice','240160wGxyab','1968iwQOMw','ErrorMsg','remove','map','field','isInteger','count','LIMIT_PARAM_ERROR','Query','5488340jSiirw','toString','bson','database.updateDocument','collection','_fieldFilters','skip','defineProperty','_request','formatRequestServerDateParams','database.calculateDocument','object','ERRORS','WHERE','INVALID_PARAM','some','3xzLpBO','501088wIXwaS','1345680ZksIjp','offset','length','./constant','UPDATE_ID_ERROR','UPDATE_PARAM_ERROR','orderBy','order-by','projection','REMOVE_PARAM_ERROR','query','prototype','order','update','total','EJSON','65CzMrdk','assign','QuerySerializer','_id','Object','encodeEJSON'];a15_0x2d13=function(){return _0x5b1ad9;};return a15_0x2d13();}class Query{constructor(_0x47816d,_0x2dfb81,_0x1d4015,_0x46ee1e){const _0x365d33=a15_0x384a08;this[_0x365d33(0xd5)]=_0x47816d,this['_coll']=_0x2dfb81,this[_0x365d33(0xaa)]=_0x1d4015,this[_0x365d33(0xcd)]=_0x46ee1e||{},this[_0x365d33(0xad)]=new basedb_1['baseDb'][(_0x365d33(0xe8))](this[_0x365d33(0xd5)]['config']);}[a15_0x384a08(0xee)](_0x2670bb){const _0x3a511d=a15_0x384a08;if(Object[_0x3a511d(0xc2)]['toString']['call'](_0x2670bb)[_0x3a511d(0xf0)](0x8,-0x1)!==_0x3a511d(0xcb))throw new Errors_1[(_0x3a511d(0xcf))](Object[_0x3a511d(0xc8)](Object['assign']({},Errors_1[_0x3a511d(0xb1)][_0x3a511d(0xb3)]),{'errMsg':Errors_1[_0x3a511d(0xf3)][_0x3a511d(0xa9)]['where']['WHERE_PARAM_OBJECT_ERROR']}));const _0x315ead=Object['keys'](_0x2670bb),_0x5b6724=_0x315ead[_0x3a511d(0xb4)](_0x1da230=>_0x2670bb[_0x1da230]!==undefined);if(_0x315ead['length']>0x0&&!_0x5b6724)throw new Errors_1['DataBaseError'](Object[_0x3a511d(0xc8)](Object[_0x3a511d(0xc8)]({},Errors_1[_0x3a511d(0xb1)]['INVALID_PARAM']),{'errMsg':Errors_1['ErrorMsg'][_0x3a511d(0xa9)]['where'][_0x3a511d(0xdb)]}));return new Query(this[_0x3a511d(0xd5)],this[_0x3a511d(0xef)],query_1[_0x3a511d(0xc9)][_0x3a511d(0xcc)](_0x2670bb),Object[_0x3a511d(0xc8)]({},this['_apiOptions']));}[a15_0x384a08(0xbd)](_0x4d1439,_0x5205f4){const _0x50484b=a15_0x384a08;if(!/^[\w.-]/['test'](_0x4d1439))throw new Errors_1[(_0x50484b(0xcf))](Object[_0x50484b(0xc8)](Object[_0x50484b(0xc8)]({},Errors_1['ERRORS'][_0x50484b(0xb3)]),{'errMsg':Errors_1['ErrorMsg'][_0x50484b(0xa9)][_0x50484b(0xbe)]['ORDER_BY_FIELD_PATH_ERROR']}));if(!constant_1[_0x50484b(0xd4)]['includes'](_0x5205f4))throw new Errors_1[(_0x50484b(0xcf))](Object['assign'](Object[_0x50484b(0xc8)]({},Errors_1[_0x50484b(0xb1)]['INVALID_PARAM']),{'errMsg':Errors_1[_0x50484b(0xf3)][_0x50484b(0xa9)][_0x50484b(0xbe)][_0x50484b(0xed)]}));const _0x4289bc={[_0x4d1439]:_0x5205f4==='desc'?-0x1:0x1},_0x586ca1=this[_0x50484b(0xcd)][_0x50484b(0xc3)]||{},_0x5bd078=Object[_0x50484b(0xc8)]({},this[_0x50484b(0xcd)],{'order':Object[_0x50484b(0xc8)]({},_0x586ca1,_0x4289bc)});return new Query(this['_db'],this[_0x50484b(0xef)],this[_0x50484b(0xaa)],_0x5bd078);}[a15_0x384a08(0xe9)](_0x41dc49){const _0x2211e2=a15_0x384a08;if(!Number[_0x2211e2(0xa1)](_0x41dc49))throw new Errors_1[(_0x2211e2(0xcf))](Object[_0x2211e2(0xc8)](Object[_0x2211e2(0xc8)]({},Errors_1[_0x2211e2(0xb1)]['INVALID_PARAM']),{'errMsg':Errors_1[_0x2211e2(0xf3)][_0x2211e2(0xa9)][_0x2211e2(0xe9)][_0x2211e2(0xa3)]}));const _0x56fbc6=Object[_0x2211e2(0xc8)]({},this[_0x2211e2(0xcd)]);return _0x56fbc6['limit']=_0x41dc49,new Query(this[_0x2211e2(0xd5)],this['_coll'],this[_0x2211e2(0xaa)],_0x56fbc6);}[a15_0x384a08(0xab)](_0x58bae9){const _0x4fdf7d=a15_0x384a08;if(!Number[_0x4fdf7d(0xa1)](_0x58bae9))throw new Errors_1[(_0x4fdf7d(0xcf))](Object['assign'](Object[_0x4fdf7d(0xc8)]({},Errors_1[_0x4fdf7d(0xb1)][_0x4fdf7d(0xb3)]),{'errMsg':Errors_1['ErrorMsg'][_0x4fdf7d(0xa9)][_0x4fdf7d(0xab)][_0x4fdf7d(0xda)]}));const _0x5252a1=Object[_0x4fdf7d(0xc8)]({},this['_apiOptions']);return _0x5252a1[_0x4fdf7d(0xb8)]=_0x58bae9,new Query(this['_db'],this[_0x4fdf7d(0xef)],this[_0x4fdf7d(0xaa)],_0x5252a1);}[a15_0x384a08(0xf6)](_0x33b1aa){const _0x225843=a15_0x384a08,_0x44a9fa={};for(const _0x56443a of Object[_0x225843(0xdf)](_0x33b1aa)){typeof _0x33b1aa[_0x56443a]===_0x225843(0xe0)&&(_0x44a9fa[_0x56443a]=_0x33b1aa[_0x56443a]===!![]?0x1:0x0),typeof _0x33b1aa[_0x56443a]===_0x225843(0xd9)&&(_0x44a9fa[_0x56443a]=_0x33b1aa[_0x56443a]>0x0?0x1:0x0),typeof _0x33b1aa[_0x56443a]===_0x225843(0xb0)&&(_0x44a9fa[_0x56443a]=_0x33b1aa[_0x56443a]);}const _0x57f769=Object[_0x225843(0xc8)]({},this[_0x225843(0xcd)]);return _0x57f769[_0x225843(0xbf)]=_0x44a9fa,new Query(this[_0x225843(0xd5)],this[_0x225843(0xef)],this[_0x225843(0xaa)],_0x57f769);}async[a15_0x384a08(0xe2)](){const _0x2b2f70=a15_0x384a08;var _0x487199,_0x205d80;const {order:_0x136683}=this[_0x2b2f70(0xcd)],_0x3df4fe={'collection_name':this['_coll'],'query_type':constant_1[_0x2b2f70(0xd8)][_0x2b2f70(0xb2)]};this[_0x2b2f70(0xaa)]&&(_0x3df4fe[_0x2b2f70(0xc1)]=this[_0x2b2f70(0xaa)]);_0x136683&&(_0x3df4fe[_0x2b2f70(0xc3)]=(0x0,util_2[_0x2b2f70(0xe7)])(_0x136683));const {offset:_0x2fcf64}=this[_0x2b2f70(0xcd)];_0x3df4fe[_0x2b2f70(0xb8)]=_0x2fcf64?_0x2fcf64:0x0;const {limit:_0x5bef83}=this[_0x2b2f70(0xcd)];_0x3df4fe['limit']=_0x5bef83?_0x5bef83:0x64;const {projection:_0x1e1cbe}=this[_0x2b2f70(0xcd)];_0x1e1cbe&&(_0x3df4fe['projection']=(0x0,util_2[_0x2b2f70(0xe7)])(_0x1e1cbe));const _0x5c50ed=await this[_0x2b2f70(0xad)]['send'](_0x2b2f70(0xe1),(0x0,util_2[_0x2b2f70(0xae)])(_0x3df4fe)),_0x152a35=(_0x487199=_0x5c50ed===null||_0x5c50ed===void 0x0?void 0x0:_0x5c50ed[_0x2b2f70(0xe5)])===null||_0x487199===void 0x0?void 0x0:_0x487199[_0x2b2f70(0xf5)](_0x364f3a=>bson_1[_0x2b2f70(0xc6)][_0x2b2f70(0xde)](_0x364f3a)),_0x402f2b=util_1[_0x2b2f70(0xd6)][_0x2b2f70(0xea)](_0x152a35!==null&&_0x152a35!==void 0x0?_0x152a35:[]);return{'data':_0x402f2b,'requestId':(_0x205d80=_0x5c50ed[_0x2b2f70(0xce)])!==null&&_0x205d80!==void 0x0?_0x205d80:''};}async[a15_0x384a08(0xa2)](){const _0x71a9c0=a15_0x384a08,_0x39f16f={'collection_name':this[_0x71a9c0(0xef)],'query_type':constant_1[_0x71a9c0(0xd8)]['WHERE']};this['_fieldFilters']&&(_0x39f16f[_0x71a9c0(0xc1)]=this['_fieldFilters']);const _0x170dcf=await this['_request'][_0x71a9c0(0xdd)](_0x71a9c0(0xaf),(0x0,util_2[_0x71a9c0(0xae)])(_0x39f16f));return{'total':_0x170dcf[_0x71a9c0(0xc5)],'requestId':_0x170dcf[_0x71a9c0(0xce)]};}async['update'](_0x3d6ec0){const _0x41786a=a15_0x384a08;var _0xf3f2cc,_0x1b6434;if(!(_0x3d6ec0&&Object[_0x41786a(0xc2)][_0x41786a(0xa6)][_0x41786a(0xd1)](_0x3d6ec0)[_0x41786a(0xf0)](0x8,-0x1)!==_0x41786a(0xcb)&&Object['keys'](_0x3d6ec0)[_0x41786a(0xb9)]>0x0))throw new Errors_1[(_0x41786a(0xcf))](Object[_0x41786a(0xc8)](Object[_0x41786a(0xc8)]({},Errors_1['ERRORS'][_0x41786a(0xb3)]),{'errMsg':Errors_1[_0x41786a(0xf3)][_0x41786a(0xa9)][_0x41786a(0xc4)][_0x41786a(0xbc)]}));if((0x0,util_2[_0x41786a(0xd3)])(_0x3d6ec0,_0x41786a(0xca)))throw new Errors_1[(_0x41786a(0xcf))](Object[_0x41786a(0xc8)](Object[_0x41786a(0xc8)]({},Errors_1[_0x41786a(0xb1)][_0x41786a(0xb3)]),{'errMsg':Errors_1[_0x41786a(0xf3)][_0x41786a(0xa9)][_0x41786a(0xc4)][_0x41786a(0xbb)]}));const _0x57407d={'collection_name':this[_0x41786a(0xef)],'query_type':constant_1[_0x41786a(0xd8)][_0x41786a(0xb2)],'multi':!![],'merge':!![],'upsert':![],'update_data':update_1[_0x41786a(0xe6)][_0x41786a(0xcc)](_0x3d6ec0)};this['_fieldFilters']&&(_0x57407d['query']=this['_fieldFilters']);const _0x5a010c=await this[_0x41786a(0xad)][_0x41786a(0xdd)](_0x41786a(0xa8),(0x0,util_2['formatRequestServerDateParams'])(_0x57407d));return{'updated':(_0xf3f2cc=_0x5a010c[_0x41786a(0xe3)])!==null&&_0xf3f2cc!==void 0x0?_0xf3f2cc:0x0,'requestId':(_0x1b6434=_0x5a010c[_0x41786a(0xce)])!==null&&_0x1b6434!==void 0x0?_0x1b6434:''};}async[a15_0x384a08(0xf4)](){const _0x150820=a15_0x384a08;var _0x13e33e,_0x5555fb;const {offset:_0x415bf7,limit:_0x28d84f,projection:_0x256075,order:_0x1840af}=this[_0x150820(0xcd)];if(_0x415bf7!==undefined||_0x28d84f!==undefined||_0x256075!==undefined||_0x1840af!==undefined)throw new Errors_1[(_0x150820(0xcf))](Object[_0x150820(0xc8)](Object[_0x150820(0xc8)]({},Errors_1[_0x150820(0xb1)][_0x150820(0xb3)]),{'errMsg':Errors_1[_0x150820(0xf3)][_0x150820(0xa9)]['remove'][_0x150820(0xc0)]}));const _0x4d48b3={'collection_name':this['_coll'],'query':this['_fieldFilters'],'query_type':constant_1[_0x150820(0xd8)][_0x150820(0xb2)],'multi':!![]},_0x244a04=await this[_0x150820(0xad)][_0x150820(0xdd)](_0x150820(0xec),(0x0,util_2[_0x150820(0xae)])(_0x4d48b3));return{'deleted':(_0x13e33e=_0x244a04===null||_0x244a04===void 0x0?void 0x0:_0x244a04['deleted'])!==null&&_0x13e33e!==void 0x0?_0x13e33e:0x0,'requestId':(_0x5555fb=_0x244a04===null||_0x244a04===void 0x0?void 0x0:_0x244a04[_0x150820(0xce)])!==null&&_0x5555fb!==void 0x0?_0x5555fb:''};}}exports[a15_0x384a08(0xa4)]=Query;